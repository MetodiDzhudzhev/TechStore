@using TechStore.Web.ViewModels.Review
@model MyReviewsListViewModel

@{
    ViewData["Title"] = "My reviews";
}

<section class="reviews">
    <header class="reviews__header">
        <h2 class="reviews__title">@ViewData["Title"]</h2>
    </header>

    @if (Model.Reviews == null || !Model.Reviews.Any())
    {
        <div class="notice notice--info" role="status">
            You don’t have any reviews yet.
        </div>
    }
    else
    {
        <div class="reviews__list">
            @foreach (var review in Model.Reviews)
            {
                var detailsDomId = $"review_{review.ReviewId}_details";
                var btnDomId = $"review_{review.ReviewId}_btn";

                <article class="reviewCard">
                    <div class="reviewCard__body">

                        <h5 class="reviewCard__title">Review #@review.ReviewId</h5>

                        <div class="reviewCard__meta">
                            <div class="reviewCard__metaRow">
                                <i class="bi bi-box-seam" aria-hidden="true"></i>
                                <span>@review.ProductName</span>
                            </div>
                        </div>

                        <div class="reviewCard__summary">
                            <div class="reviewCard__rating">
                                <i class="bi bi-star-fill" aria-hidden="true"></i>
                                <span>@review.Rating / 5</span>
                            </div>

                            <button id="@btnDomId"
                                    class="btn btn--info btn--sm reviewCard__toggle"
                                    type="button"
                                    aria-expanded="false"
                                    aria-controls="@detailsDomId"
                                    data-target="#@detailsDomId">
                                <span class="reviewCard__toggleText">Show details</span>
                            </button>
                        </div>

                        <div class="reviewDetails" id="@detailsDomId" hidden>
                            <hr class="reviewDetails__divider" />

                            <div class="reviewDetails__meta">
                                <div class="reviewDetails__metaRow">
                                    <i class="bi bi-calendar3" aria-hidden="true"></i>
                                    <span>@review.CreatedAt</span>
                                </div>
                            </div>

                            <div class="reviewComment">
                                <div class="reviewComment__title">Comment</div>

                                @if (!string.IsNullOrWhiteSpace(review.Comment))
                                {
                                    <div class="reviewComment__text">@review.Comment</div>
                                }
                                else
                                {
                                    <div class="reviewComment__empty">No comment provided.</div>
                                }
                            </div>

                            <div class="reviewProduct">
                                <div class="reviewProduct__title">Product</div>

                                <a class="reviewProduct__link"
                                   asp-area=""
                                   asp-controller="Product"
                                   asp-action="Details"
                                   asp-route-id="@review.ProductId">

                                    <div class="reviewProductCard">
                                        <div class="reviewProductCard__row">
                                            <div class="reviewProductCard__thumb">
                                                @if (!string.IsNullOrWhiteSpace(review.ProductImage))
                                                {
                                                    <img src="@review.ProductImage" alt="@review.ProductName" />
                                                }
                                                else
                                                {
                                                    <img src="~/images/default-image.jpg" alt="No Image Available" />
                                                }
                                            </div>

                                            <div class="reviewProductCard__content">
                                                <div class="reviewProductCard__name">@review.ProductName</div>
                                                <div class="reviewProductCard__hint">Click to open product details</div>
                                            </div>
                                        </div>
                                    </div>

                                </a>
                            </div>

                        </div>
                    </div>
                </article>
            }
        </div>

        @if (Model.TotalPages > 1)
        {
            <nav class="pagination" aria-label="Reviews pagination">
                <a class="pagination__link"
                   aria-disabled="@(Model.HasPreviousPage ? "false" : "true")"
                   tabindex="@(Model.HasPreviousPage ? "0" : "-1")"
                   asp-area="Account"
                   asp-controller="Account"
                   asp-action="MyReviews"
                   asp-route-page="@(Model.CurrentPage - 1)">
                    Previous
                </a>

                <div class="pagination__pages">
                    @for (int p = 1; p <= Model.TotalPages; p++)
                    {
                        <a class="pagination__link @(p == Model.CurrentPage ? "pagination__link--active" : "")"
                           aria-current="@(p == Model.CurrentPage ? "page" : null)"
                           asp-area="Account"
                           asp-controller="Account"
                           asp-action="MyReviews"
                           asp-route-page="@p">
                            @p
                        </a>
                    }
                </div>

                <a class="pagination__link"
                   aria-disabled="@(Model.HasNextPage ? "false" : "true")"
                   tabindex="@(Model.HasNextPage ? "0" : "-1")"
                   asp-area="Account"
                   asp-controller="Account"
                   asp-action="MyReviews"
                   asp-route-page="@(Model.CurrentPage + 1)">
                    Next
                </a>
            </nav>
        }
    }
</section>

@section Styles {
    <link rel="stylesheet" href="~/css/pages/my-reviews.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/js/my-reviews.js" asp-append-version="true"></script>
}
