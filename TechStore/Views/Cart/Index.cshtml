@model TechStore.Web.ViewModels.Cart.CartViewModel

@{
    ViewData["Title"] = "My Cart";
}

<section class="cart">
    <header class="cart__header">
        <h1 class="cart__title">🛒 My Cart</h1>
    </header>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="notice notice--danger" role="alert">
            @TempData["ErrorMessage"]
        </div>
    }

    @if (!Model.Products.Any())
    {
        <div class="notice notice--empty" role="status">
            Your cart is empty.
        </div>
    }
    else
    {
        <div class="cart__tableWrap">
            <table class="cartTable">
                <thead class="cartTable__head">
                    <tr>
                        <th class="cartTable__colImg"></th>
                        <th>Product</th>
                        <th class="cartTable__colPrice">Price</th>
                        <th class="cartTable__colQty">Quantity</th>
                        <th class="cartTable__colTotal">Total</th>
                        <th class="cartTable__colActions"></th>
                    </tr>
                </thead>

                <tbody class="cartTable__body">
                    @foreach (var product in Model.Products)
                    {
                        <tr class="cartRow">
                            <td>
                                <a class="cartRow__imgLink"
                                   asp-controller="Product"
                                   asp-action="Details"
                                   asp-route-id="@product.ProductId"
                                   title="View product details">
                                    <img src="@product.ImageUrl"
                                         alt="@product.Name"
                                         class="cartRow__img" />
                                </a>
                            </td>

                            <td class="cartRow__name">@product.Name</td>

                            <td class="cartRow__price">@product.Price.ToString("F2") €</td>

                            <td>
                                <div class="qty">
                                    <form asp-action="Decrease" method="post">
                                        <input type="hidden" name="productId" value="@product.ProductId" />
                                        <button type="submit"
                                                class="btn btn--ghost"
                                                @(product.Quantity == 1 ? "disabled" : "")>
                                            −
                                        </button>
                                    </form>

                                    <span class="qty__value">@product.Quantity</span>

                                    <form asp-action="Increase" method="post">
                                        <input type="hidden" name="productId" value="@product.ProductId" />
                                        <input type="hidden" name="quantity" value="1" />
                                        <button type="submit" class="btn btn--ghost">+</button>
                                    </form>
                                </div>
                            </td>

                            <td class="cartRow__total">@((product.Price * product.Quantity).ToString("F2")) €</td>

                            <td class="cartRow__actions">
                                <form asp-action="Remove" method="post">
                                    <input type="hidden" name="productId" value="@product.ProductId" />
                                    <button type="submit" class="btn btn--danger btn--sm">Remove</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <footer class="cart__footer">
            <div class="cart__footerTop">
                <div class="cart__total">
                    <span>Total:</span>
                    <strong>@Model.TotalPrice.ToString("F2") €</strong>
                </div>
            </div>

            <div class="cart__footerBottom">
                <form asp-action="Clear" method="post" data-cart-clear>
                    <button type="submit" class="btn btn--danger btn--sm">Clear cart</button>
                </form>

                <a asp-controller="Order"
                   asp-action="Checkout"
                   class="btn btn--primary btn--lg">
                    Proceed to checkout
                </a>
            </div>
        </footer>


    }
</section>

@section Styles {
    <link rel="stylesheet" href="~/css/pages/cart.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/js/cart.js" asp-append-version="true"></script>
}
