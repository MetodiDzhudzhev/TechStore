@using TechStore.Web.ViewModels.Product
@model ProductsByCategoryViewModel

@{
    ViewData["Title"] = $"Products in {Model.CategoryName}";
}

<div class="d-flex justify-content-between align-items-center mb-3" style="margin-top: 20px;">
    <h2>@ViewData["Title"]</h2>

    @if (User?.Identity?.IsAuthenticated == true &&
        (User.IsInRole("Manager") || User.IsInRole("Admin")))
    {
        <a asp-area="ControlPanel"
           asp-controller="ControlPanelProduct"
           asp-action="Add"
           asp-route-categoryId="@Model.CategoryId"
           class="btn btn-primary">
            <i class="fas fa-plus"></i> Add product
        </a>
    }
</div>

<hr />

<div class="container mt-4">

    <form method="get" class="mb-4 d-flex gap-2 align-items-center">
        <input type="hidden" name="categoryId" value="@Model.CategoryId" />

        <label class="fw-semibold">Sort by:</label>

        <select name="sort"
                class="form-select"
                style="max-width: 220px;"
                onchange="this.form.submit()">

            <option value="@ProductSort.NameAsc"
                    selected="@(Model.Sort == ProductSort.NameAsc)">
                Name
            </option>

            <option value="@ProductSort.PriceAsc"
                    selected="@(Model.Sort == ProductSort.PriceAsc)">
                Price ↑
            </option>

            <option value="@ProductSort.PriceDesc"
                    selected="@(Model.Sort == ProductSort.PriceDesc)">
                Price ↓
            </option>
        </select>
    </form>

    @if (!Model.Products.Any())
    {
        <div class="alert alert-info">
            There are no products in this category.
        </div>
    }
    else
    {
        @foreach (var product in Model.Products)
        {
            <div class="card bg-light text-dark shadow rounded mb-4 p-3">
                <div class="row g-0 align-items-center">

                    <div class="col-md-4 text-center">
                        <img src="@product.ImageUrl"
                             alt="@product.Name"
                             class="img-fluid rounded"
                             style="max-height: 300px; object-fit: contain;" />
                    </div>

                    <div class="col-md-8">
                        <div class="card-body">
                            <h4 class="card-title fw-bold">@product.Name</h4>

                            <p class="card-text">
                                <strong>Price:</strong>
                                @product.Price.ToString("F2") €<br />
                                <strong>Quantity in Stock:</strong>
                                @product.QuantityInStock
                            </p>

                            <a asp-controller="Product"
                               asp-action="Details"
                               asp-route-id="@product.Id"
                               class="btn btn-primary fw-semibold mt-2 px-4 rounded-pill">
                                View Details
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        }
    }

    <div class="mt-4">
        <a asp-controller="Category"
           asp-action="Index"
           class="btn btn-outline-secondary fw-bold px-4 rounded-pill">
            <i class="fas fa-arrow-left"></i> Back to Categories
        </a>
    </div>
</div>
